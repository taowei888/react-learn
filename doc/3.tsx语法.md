# 3. TSX 语法

## 概述

### JSX 简介
JSX 是 JavaScript 的语法扩展，允许在 JavaScript 中编写类似 HTML 的代码。

### TSX 与 JSX 的区别
TSX 是 JSX 的 TypeScript 版本，基本语法相同，主要区别是增加了类型支持。

```tsx
const element = <div>Hello React</div>
```

## 基础语法

### 变量绑定
在 TSX 中使用 `{}` 来绑定 JavaScript 表达式：

```tsx
function App() {
  const fn = (param: number) => console.log("click", param);
  const b1 = false;
  const id = "999";

  return (
    <>
      <div>{"1"}</div>                {/* 字符串 */}
      <div>{1}</div>                   {/* 数字 */}
      <div>{new Date().getTime()}</div> {/* 函数调用 */}
      <div>{[1, 2, 3]}</div>          {/* 简单数组 */}
      <div>{b1 ? 1 : 2}</div>         {/* 三元表达式 */}
    </>
  )
}
```

### 属性绑定

#### 基础属性绑定
```tsx
function App() {
  const id = "999";
  const style = { color: "red" };
  const cls1 = "a";

  return (
    <div id={id} style={style} className={cls1}>
      test
    </div>
  )
}
```

#### 多个 CSS 类绑定
```tsx
function App() {
  const cls1 = "a";
  const cls2 = "b";

  return (
    <div className={`${cls1} ${cls2} aa bb cc`}>
      多个class
    </div>
  )
}
```

**注意**：在 React 中使用 `className` 而不是 `class`，因为 `class` 是 JavaScript 的保留字。

### 事件处理
事件名使用小驼峰命名法，如 `onClick`、`onChange` 等：

```tsx
function App() {
  const fn = (param: number) => console.log("click", param);

  return (
    <button onClick={() => fn(123)}>click</button>
  )
}
```

## 高级用法

### HTML 内容渲染
使用 `dangerouslySetInnerHTML` 渲染 HTML 字符串：

```tsx
function App() {
  const html = '<h1 style="color:red">title</h1>';

  return (
    <div dangerouslySetInnerHTML={{ __html: html }}></div>
  )
}
```

**警告**：使用 `dangerouslySetInnerHTML` 时要确保 HTML 内容是安全的，避免 XSS 攻击。

### 列表渲染
使用 `map` 方法遍历数组生成元素列表：

```tsx
function App() {
  const arr = [1, 2, 3, 4, 5];

  return (
    <>
      {arr.map((item) => {
        return <div key={String(item)} id={String(item)}>{item}</div>;
      })}
    </>
  )
}
```

**注意**：遍历时需要为每个元素提供唯一的 `key` 属性，这里使用 `id` 属性同时满足了 key 的需求。

### 条件渲染
使用三元表达式或逻辑运算符进行条件渲染：

```tsx
function App() {
  const flag = false;

  return (
    <>
      {flag ? <div>显示</div> : <div>隐藏</div>}
      {flag && <div>仅在 true 时显示</div>}
    </>
  )
}
```

### TSX 中使用泛型
在 TSX 中使用泛型时，需要在类型参数后添加逗号，避免与 JSX 标签冲突：

```tsx
function App() {
  // 正确写法：泛型后加逗号
  const genericFunction = <T,>(param: T): T => param;

  return <div>{genericFunction("hello")}</div>
}
```

## 语法限制和注意事项

### 插值表达式限制
在 `{}` 中不能使用以下语句：
- `if/else` 语句（使用三元表达式代替）
- `switch` 语句
- 变量声明（`let`、`const`、`var`）
- 直接放置对象（需要访问对象属性）

```tsx
// ❌ 错误用法
function App() {
  const obj = { name: 'React' };
  return (
    <>
      {obj}  {/* 不能直接渲染对象 */}
      {
        if (true) {
          <div>条件</div>
        }
      }
    </>
  )
}

// ✅ 正确用法
function App() {
  const obj = { name: 'React' };
  const showDiv = true;

  return (
    <>
      {obj.name}  {/* 访问对象属性 */}
      {JSON.stringify(obj)}  {/* 或转换为字符串 */}
      {showDiv ? <div>条件</div> : null}  {/* 使用三元表达式 */}
    </>
  )
}
```

## 最佳实践

1. **类型安全**：充分利用 TypeScript 的类型检查
2. **组件拆分**：将复杂的 JSX 拆分为更小的组件
3. **避免内联函数**：在事件处理中避免创建不必要的内联函数
4. **合理使用 Fragment**：使用 `<>` 或 `<Fragment>` 避免不必要的 DOM 节点
5. **安全的 HTML 渲染**：谨慎使用 `dangerouslySetInnerHTML`

## FAQ

### 为什么使用 className 而不是 class？
`class` 是 JavaScript 的保留关键字，在 JSX 中使用 `className` 来设置 CSS 类名。

### 什么时候需要使用 key 属性？
在渲染列表时必须为每个元素提供唯一的 `key` 属性，帮助 React 识别哪些元素发生了变化。